#!/usr/bin/env bash

source lib/db.sh
source lib/utils.sh
source lib/commands/install_pkg.sh
source lib/commands/remove_pkg.sh
source lib/commands/remove_label.sh
source lib/commands/remove_common.sh
source lib/commands/list_pkg.sh
source lib/commands/list_labels.sh
source lib/commands/search_pkg.sh
source lib/commands/search_label.sh
source lib/commands/edit_package_label.sh
source lib/commands/rename_label.sh
source lib/commands/help.sh

# DB_FILE="lib/db.sh"
PROGRAM_NAME="tstall"
PROGRAM_VERSION="1.0.0"

main() {
    local CMD="$1"
    shift
    case "$CMD" in
        install)
            if [[ -n "$@" ]]; then
                install_package "$@"
            else
                echo "Error: requires atleast one <package>, type '$PROGRAM_NAME help $CMD' for help."
            fi
            ;;
        remove)
            if [[ -n "$@" ]]; then
                remove_package "$@"
            else
                echo "Error: requires atleast one <package>, type '$PROGRAM_NAME help $CMD' for help."
            fi
            ;;
        remove-label)
            if [[ $# -eq 1 ]]; then
                remove_label "$1"
            elif [[ $# -gt 1 ]]; then
                echo "Error: too many arguments for command, type '$PROGRAM_NAME help $CMD' for help."
            else
                echo "Error: requires <label>, type '$PROGRAM_NAME help $CMD' for help."
            fi
            ;;
        list)
            if [[ -z "$@" ]]; then
                list_installed_packages
            else
                echo "Error: too many arguments for command, type '$PROGRAM_NAME help' for help."
            fi
            ;;
        list-labels)
            if [[ -z "$@" ]]; then
                list_labels
            else
                echo "Error: too many arguments for command, type '$PROGRAM_NAME help' for help."
            fi
            ;;
        search)
            if [[ $# -eq 1 ]]; then
                search_pkg "$1"
            elif [[ $# -gt 1 ]]; then
                echo "Error: too many arguments for command, type '$PROGRAM_NAME help $CMD' for help."
            else
                echo "Error: requires <package>, type '$PROGRAM_NAME help $CMD' for help."
            fi
            ;;
        search-label)
            if [[ $# -eq 1 ]]; then
                search_label "$1"
            elif [[ $# -gt 1 ]]; then
                echo "Error: too many arguments for command, type '$PROGRAM_NAME help $CMD' for help."
            else
                echo "Error: requires <label>, type '$PROGRAM_NAME help $CMD' for help." 
            fi
            ;;
        edit-package-label)
            if [[ $# -eq 2 ]]; then
                edit_package_label "$1" "$2"
            elif [[ $# -gt 2 ]]; then
                echo "Error: too many arguments for command, type '$PROGRAM_NAME help $CMD' for help."
            else
                echo "Error: requires <package> and <label>, type '$PROGRAM_NAME help $CMD' for help."
            fi
            ;;
        rename-label)
            if [[ $# -eq 2 ]]; then
                rename_label "$1" "$2"
            elif [[ $# -gt 2 ]]; then
                echo "Error: too many arguments for command, type '$PROGRAM_NAME help $CMD' for help."
            else
                echo "Error: requires <label> and <new label>, type '$PROGRAM_NAME help $CMD' for help."
            fi
            ;;
        -v|--version|version)
            if [[ -z "$@" ]]; then
                echo "$PROGRAM_NAME $PROGRAM_VERSION"
            else
                echo "Error: too many arguments for command, type '$PROGRAM_NAME help' for help."
            fi
            ;;
        -h|--help|help)
            if [[ "$#" -eq 0 ]]; then
                help
            elif [[ "$#" -eq 1 ]]; then
                help_command "$1"
            else
                echo "Error: too many arguments for command, type '$PROGRAM_NAME help' for help."
            fi
            ;;
        *)
            echo "Error: unknown command, type '$PROGRAM_NAME help' for help."
    esac
}

# init_db
main "$@"
# list_installed_packages